name: KB Organize

on:
  schedule:
    - cron: "0 */12 * * *"
  workflow_dispatch:

permissions:
  contents: write

concurrency:
  group: kb-organize
  cancel-in-progress: false

jobs:
  organize:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main
        uses: actions/checkout@v4
        with:
          ref: main
          fetch-depth: 0

      - name: Setup uv
        uses: astral-sh/setup-uv@v4

      - name: Sync dependencies
        run: uv sync --project ops --frozen

      - name: Run scheduled organize
        env:
          GIT_AUTHOR_NAME: your-username        # TODO: Replace with your GitHub username
          GIT_AUTHOR_EMAIL: your-email@example.com  # TODO: Replace with your GitHub email
          GIT_COMMITTER_NAME: your-username      # TODO: Replace with your GitHub username
          GIT_COMMITTER_EMAIL: your-email@example.com  # TODO: Replace with your GitHub email
        run: bash ops/ci/scheduled-organize.sh
